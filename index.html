<!DOCTYPE html>
<html>
<head>
  <title>Global Governance & Compliance Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@400;600;700;800&display=swap" rel="stylesheet">

 <style>
/* ================= UPDATED DARK THEME STYLES ================= */

/* Color Palette Variables */
:root {
  --teal: #00FAC2;
  --dark-teal: #008F66;
  --purple: #6666CC;
  --pink: #CC0066;
  --emerald: #10B981;
  --electric-blue: #3B82F6;
  --amber: #F59E0B;
  --crimson: #DC2626;
  --yellow: #FFC804;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  height: 100vh;
  overflow: hidden;
}

body { 
  font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #000000;
  color: #ffffff;
  display: flex;
  flex-direction: column;
  padding-top: 70px;
  position: relative;
}


.top-section {
  background: rgba(0, 0, 0, 0.6);
  border: 2px solid rgba(0, 250, 194, 0.3);
  border-radius: 18px;
  margin: 10px 24px 10px 24px;
  padding: 18px 24px;
  box-shadow: 0 8px 32px rgba(0, 250, 194, 0.15);
  flex-shrink: 0;
  backdrop-filter: blur(20px);
}

h1 { 
  margin: 0 0 20px 0; 
  color: var(--teal); 
  font-size: 24px; 
  font-weight: 800;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  background: linear-gradient(135deg, #ffffff 0%, var(--teal) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.metrics-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 16px;
  margin-bottom: 0;
}

.metric-box {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(0, 250, 194, 0.3);
  border-radius: 14px;
  padding: 16px 12px;
  text-align: center;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.metric-box:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 32px rgba(0, 250, 194, 0.3);
  border-color: var(--teal);
  background: rgba(255, 255, 255, 0.06);
}

.metric-icon {
  font-size: 32px;
  margin-bottom: 8px;
  filter: grayscale(0.3) brightness(1.2);
}

.metric-value {
  font-size: 22px;
  font-weight: 800;
  color: #ffffff;
  margin-bottom: 5px;
  font-family: 'Space Grotesk', 'Inter', system-ui, sans-serif;
}

.metric-label {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Map and detail container styles */
#map {
  flex: 1;
  height: auto !important;
  margin: 0 24px 16px 24px;
  border-radius: 20px;
  border: 2px solid rgba(0, 250, 194, 0.3);
  position: relative;
  box-shadow: 0 8px 32px rgba(0, 250, 194, 0.15);
  min-height: 0;
}

.label {
  background: linear-gradient(135deg, var(--teal) 0%, var(--dark-teal) 100%);
  color: #000000;
  padding: 10px 20px;
  border-radius: 25px;
  font-size: 15px;
  white-space: nowrap;
  font-weight: 800;
  box-shadow: 0 4px 12px rgba(0, 250, 194, 0.4);
  letter-spacing: 0.5px;
  border: 2px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
}

.label.city-label {
  padding: 7px 14px;
  font-size: 13px;
  font-weight: 700;
  border-radius: 20px;
}

.back-btn {
  position: fixed;
  top: 90px;
  left: 40px;
  z-index: 1000;
  background: rgba(0, 0, 0, 0.85);
  color: var(--teal);
  padding: 10px 20px;
  border-radius: 10px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  display: none;
  box-shadow: 0 4px 16px rgba(0, 250, 194, 0.3);
  border: 2px solid var(--teal);
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.back-btn:hover {
  background: rgba(0, 0, 0, 0.9);
  border-color: var(--teal);
  color: #ffffff;

  box-shadow:
    0 0 12px rgba(0, 250, 194, 0.6),
    0 0 24px rgba(0, 250, 194, 0.3);

  transform: translateX(-6px);
}


#detailView {
  display: none;
  margin: 0 24px 24px 24px;
  border-radius: 20px;
  border: 2px solid rgba(0, 250, 194, 0.3);
  padding: 80px 40px 40px 40px;
  overflow-y: auto;
  box-sizing: border-box;
  flex: 1 1 auto;
  background: rgba(0, 0, 0, 0.6);
  box-shadow: 0 8px 32px rgba(0, 250, 194, 0.15);
  backdrop-filter: blur(20px);
}

h2 { 
  margin-top: 0; 
  margin-left: 0;
  margin-bottom: 20px;
  color: #ffffff;
  font-size: 28px;
  font-weight: 800;
  letter-spacing: 0.5px;
  padding-bottom: 12px;
  border-bottom: 3px solid #07aa87;
  font-family: 'Space Grotesk', sans-serif;
  background: linear-gradient(135deg, #ffffff 0%, var(--teal) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-transform: uppercase;
  text-shadow: none;
  filter: brightness(1.2) contrast(1.1);
}
h3 { 
  margin-top: 35px; 
  color: #ffffff;
  font-size: 18px;
  font-weight: 700;
  letter-spacing: 0.6px;
  text-transform: uppercase;
  padding-bottom: 12px;
  border-bottom: 2px solid rgba(0, 250, 194, 0.4);
  font-family: 'Space Grotesk', sans-serif;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(0, 250, 194, 0.8) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: flex;
  align-items: center;
  gap: 10px;
  filter: brightness(1.2) contrast(1.1);
}

/* Make emojis more visible */
h2, h3, .card, .office-title {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Emoji visibility enhancement */
* {
  text-rendering: optimizeLegibility;
}

.grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-top: 24px;
}
.card {
  border: 1px solid rgba(0, 250, 194, 0.3);
  border-radius: 14px;
  padding: 20px 22px;
  font-size: 14px;
  background: rgba(255, 255, 255, 0.03);
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  color: rgba(255, 255, 255, 0.8);
  font-weight: 600;
  line-height: 1.6;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 32px rgba(0, 250, 194, 0.25);
  border-color: var(--teal);
  background: rgba(255, 255, 255, 0.06);
}
.card b {
  display: block;
  margin-top: 10px;
  font-size: 22px;
  color: #ffffff;
  font-weight: 800;
  letter-spacing: -0.3px;
  font-family: 'Space Grotesk', sans-serif;
}

/* ========== COMPLIANCE STYLES (DARK THEME) ========== */
.compliance-section {
  margin-top: 30px;
  border-top: 2px solid rgba(0, 250, 194, 0.3);
  padding-top: 24px;
}

.compliance-section h3 {
  -webkit-text-fill-color: #ffffff !important;
  color: #ffffff !important;
  font-size: 16px;
  font-weight: 800;
  margin-bottom: 16px;
  border-bottom: none;
  padding: 12px 18px;
  background: linear-gradient(135deg, rgba(102, 102, 204, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
  border: 2px solid rgba(102, 102, 204, 0.4);
  border-radius: 12px;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  box-shadow: 0 8px 24px rgba(102, 102, 204, 0.2);
  letter-spacing: 0.5px;
  text-transform: uppercase;
  transition: all 0.3s ease;
  width: auto;
  white-space: nowrap;
}

.compliance-section h3:hover {
  background: linear-gradient(135deg, rgba(102, 102, 204, 0.25) 0%, rgba(139, 92, 246, 0.2) 100%);
  border-color: var(--purple);
  box-shadow: 0 12px 32px rgba(102, 102, 204, 0.3);
  transform: translateY(-2px);
}

.compliance-section h3::first-letter {
  font-size: 36px;
  margin-right: 8px;
  filter: brightness(1.4) contrast(1.2);
}

.compliance-sites-container {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.compliance-site-card {
  background: linear-gradient(135deg, rgba(20, 20, 30, 0.8) 0%, rgba(10, 10, 20, 0.9) 100%);
  border: 2px solid rgba(0, 250, 194, 0.3);
  border-radius: 16px;
  padding: 28px;
  max-width: 700px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}
.compliance-site-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 16px 48px rgba(0, 250, 194, 0.25);
  border-color: var(--teal);
  background: linear-gradient(135deg, rgba(25, 25, 35, 0.85) 0%, rgba(15, 15, 25, 0.95) 100%);
}

.compliance-site-card h4 {
  color: #ffffff;
  font-size: 22px;
  font-weight: 800;
  margin: 0 0 20px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  letter-spacing: 0.5px;
  font-family: 'Space Grotesk', sans-serif;
  padding-bottom: 14px;
  border-bottom: 2px solid rgba(0, 250, 194, 0.2);
}
.compliance-score {
  background: linear-gradient(135deg, var(--purple) 0%, #5B5BD6 100%);
  color: #ffffff;
  padding: 8px 20px;
  border-radius: 20px;
  font-size: 18px;
  font-weight: 800;
  box-shadow: 0 6px 16px rgba(105, 102, 204, 0.4);
  letter-spacing: 0.5px;
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.compliance-chart-container {
  height: 260px;
  position: relative;
  margin-top: 12px;
  padding: 20px 20px 20px 40px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 12px;
}

.drawer {
  position: fixed;
  top: 70px;
  right: -680px;
  width: 620px;
  height: calc(100vh - 70px);
  background: rgba(10, 10, 10, 0.98);
  border-left: 3px solid var(--teal);
  box-shadow: -12px 0 48px rgba(0, 0, 0, 0.9);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  z-index: 1000;
  transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(20px);
}

.drawer.open {
  right: 0;
}

.drawer-header {
  padding: 24px 28px;
  border-bottom: 3px solid var(--teal);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(0, 0, 0, 0.95);
  flex-shrink: 0;
}

.drawer-header h2 {
  margin: 0;
  font-size: 24px;
  font-weight: 800;
  color: #ffffff;
  line-height: 1.3;
  border: none;
  padding: 0;
  letter-spacing: 0.8px;
  text-transform: uppercase;
  background: linear-gradient(135deg, #ffffff 0%, var(--teal) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.drawer-body {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
}

.close-btn {
  background: linear-gradient(135deg, var(--pink) 0%, #9a0056 100%);
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(195, 0, 110, 0.4);
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: linear-gradient(135deg, #9a0056 0%, var(--pink) 100%);
  transform: scale(1.05);
  box-shadow: 0 6px 24px rgba(195, 0, 110, 0.6);
}

.section {
  margin-bottom: 40px;
}

.section h3 {
  font-size: 19px;
  font-weight: 800;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
  border-bottom: 3px solid rgba(255, 255, 255, 0.15);
  padding-bottom: 14px;
}

.section h3::before {
  font-size: 24px;
  font-weight: 900;
  display: inline-block;
  width: 32px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  border-radius: 8px;
  flex-shrink: 0;
}

.section.done h3 { 
  color: var(--emerald); 
  border-bottom-color: var(--emerald);
  text-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
}

.section.done h3::before {
  content: "‚úì";
  background: rgba(16, 185, 129, 0.2);
  color: var(--emerald);
  border: 2px solid var(--emerald);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.section.progress h3 { 
  color: var(--amber); 
  border-bottom-color: var(--amber);
  text-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
}

.section.progress h3::before {
  content: "‚óê";
  background: rgba(245, 158, 11, 0.2);
  color: var(--amber);
  border: 2px solid var(--amber);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.section.pending h3 { 
  color: var(--pink); 
  border-bottom-color: var(--pink);
  text-shadow: 0 0 20px rgba(204, 0, 102, 0.3);
}

.section.pending h3::before {
  content: "‚úï";
  background: rgba(204, 0, 102, 0.2);
  color: var(--pink);
  border: 2px solid var(--pink);
  box-shadow: 0 4px 12px rgba(204, 0, 102, 0.3);
}

.item {
  background: rgba(255, 255, 255, 0.08);
  padding: 20px;
  margin-bottom: 16px;
  border-radius: 14px;
  border-left: 5px solid rgba(255, 255, 255, 0.3);
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

.item:hover {
  background: rgba(255, 255, 255, 0.12);
  transform: translateX(8px);
  box-shadow: 0 6px 20px rgba(0, 250, 194, 0.25);
}

.section.done .item { 
  border-left-color: var(--emerald);
  background: rgba(16, 185, 129, 0.08);
}

.section.done .item:hover {
  background: rgba(16, 185, 129, 0.15);
  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
}

.section.progress .item { 
  border-left-color: var(--amber);
  background: rgba(245, 158, 11, 0.08);
}

.section.progress .item:hover {
  background: rgba(245, 158, 11, 0.15);
  box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
}

.section.pending .item { 
  border-left-color: var(--pink);
  background: rgba(204, 0, 102, 0.08);
}

.section.pending .item:hover {
  background: rgba(204, 0, 102, 0.15);
  box-shadow: 0 6px 20px rgba(204, 0, 102, 0.3);
}

.item strong {
  display: block;
  color: #ffffff;
  margin-bottom: 10px;
  font-size: 17px;
  font-weight: 700;
  letter-spacing: 0.3px;
  line-height: 1.4;
}

.item small {
  color: rgba(255, 255, 255, 0.7);
  font-size: 14px;
  font-weight: 600;
  display: block;
  margin-bottom: 12px;
}

.category-badge {
  display: inline-block;
  padding: 7px 18px;
  border-radius: 18px;
  font-size: 12px;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-top: 12px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
  border: 2px solid;
}

.badge-facility { 
  background: rgba(0, 250, 194, 0.15); 
  color: var(--teal);
  border-color: var(--teal);
  box-shadow: 0 3px 10px rgba(0, 250, 194, 0.3);
}

.badge-fire { 
  background: rgba(204, 0, 102, 0.15); 
  color: #FF4081;
  border-color: #FF4081;
  box-shadow: 0 3px 10px rgba(204, 0, 102, 0.3);
}

.badge-statutory { 
  background: rgba(0, 143, 102, 0.15); 
  color: #00FAC2;
  border-color: #00FAC2;
  box-shadow: 0 3px 10px rgba(0, 143, 102, 0.3);
}

.badge-vendor { 
  background: rgba(255, 200, 4, 0.15); 
  color: #FFD700;
  border-color: #FFD700;
  box-shadow: 0 3px 10px rgba(255, 200, 4, 0.3);
}

.badge-environment { 
  background: rgba(102, 102, 204, 0.15); 
  color: #9B9BFF;
  border-color: #9B9BFF;
  box-shadow: 0 3px 10px rgba(102, 102, 204, 0.3);
}

.badge-security { 
  background: rgba(59, 130, 246, 0.15); 
  color: #60A5FA;
  border-color: #60A5FA;
  box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3);
}

/* Hide all Leaflet controls */
.leaflet-control-attribution,
.leaflet-control-zoom,
.leaflet-control,
.leaflet-bottom,
.leaflet-right,
.leaflet-top {
  display: none !important;
  visibility: hidden !important;
}

#map .leaflet-control-container .leaflet-bottom.leaflet-right {
  display: none !important;
}

/* ======== FULL HEIGHT LAYOUT ======== */
.page-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}

.page-main-inner {
  flex: 1;
  position: relative;
  display: flex;
  min-height: 0;
  overflow: hidden;
}

.page-main-inner #map {
  margin: 12px 16px 12px 16px;
}

.leaflet-container {
  height: 100% !important;
  background: #0a0a0a !important;
}

/* ========== TOP NAVIGATION BAR ========== */
.top-nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 70px;
  background: rgba(0, 0, 0, 0.95);
  border-bottom: 2px solid rgba(0, 250, 194, 0.3);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 32px;
  z-index: 2000;
  box-shadow: 0 4px 24px rgba(0, 250, 194, 0.15);
  backdrop-filter: blur(30px);
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 16px;
}

.logo-container img {
  height: 78px;
  width: auto;
  filter: brightness(0) invert(1) drop-shadow(0 2px 8px rgba(0, 250, 194, 0.3));
  transition: transform 0.3s ease;
}

.logo-container img:hover {
  transform: scale(1.05);
}

.logo-text {
  font-size: 20px;
  font-weight: 800;
  color: var(--teal);
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

.nav-actions {
  display: flex;
  gap: 12px;
}

.nav-btn {
  background: linear-gradient(135deg, var(--teal) 0%, var(--dark-teal) 100%);
  color: #000000;
  border: none;
  padding: 12px 24px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 250, 194, 0.4);
  letter-spacing: 0.5px;
}

.nav-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 24px rgba(0, 250, 194, 0.5);
}

.nav-btn:active {
  transform: translateY(0);
}

.back-btn-nav {
  background: linear-gradient(135deg, var(--pink) 0%, #9a0056 100%);
  color: #ffffff;
}

.back-btn-nav:hover {
  box-shadow: 0 6px 24px rgba(195, 0, 110, 0.5);
}

.back-btn-nav:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: none;
}

.office-block {
  margin-top: 50px;
  padding-top: 40px;
  border-top: 3px dashed rgba(0, 250, 194, 0.3);
}
.office-title {
  font-size: 24px;
  font-weight: 800;
  color: #ffffff;
  margin-bottom: 20px;
  letter-spacing: 0.5px;
  font-family: 'Space Grotesk', sans-serif;
  background: linear-gradient(135deg, rgba(0, 250, 194, 0.2) 0%, rgba(16, 185, 129, 0.15) 100%);
  border: 2px solid rgba(0, 250, 194, 0.4);
  border-radius: 14px;
  padding: 16px 24px;
  display: inline-flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 8px 24px rgba(0, 250, 194, 0.2);
  transition: all 0.3s ease;
}

.office-title:hover {
  background: linear-gradient(135deg, rgba(0, 250, 194, 0.25) 0%, rgba(16, 185, 129, 0.2) 100%);
  border-color: var(--teal);
  box-shadow: 0 12px 32px rgba(0, 250, 194, 0.3);
  transform: translateY(-2px);
}

/* Make emoji in office title larger and more visible */
.office-title::first-letter {
  font-size: 40px;
  margin-right: 8px;
  filter: brightness(1.4) contrast(1.2);
}

.nav-title {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-size: 26px;
  font-weight: 800;
  color: #ffffff;
  letter-spacing: 0.9px;
  text-transform: uppercase;
  white-space: nowrap;
  font-family: 'Space Grotesk', sans-serif;
  background: linear-gradient(135deg, #ffffff 0%, var(--teal) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.clickable-label {
  transition: all 0.3s ease;
  font-size: 14px !important;
}

.clickable-label.force-hover {
  background: linear-gradient(135deg, #00FAC2 0%, #008F66 100%) !important;
  transform: scale(1.08);
  box-shadow: 0 8px 24px rgba(0, 250, 194, 0.5) !important;
  z-index: 1000 !important;
  border-color: #ffffff !important;
}

/* Scrollbar Styling */
#detailView::-webkit-scrollbar,
.drawer-body::-webkit-scrollbar {
  width: 8px;
}

#detailView::-webkit-scrollbar-track,
.drawer-body::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

#detailView::-webkit-scrollbar-thumb,
.drawer-body::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--teal) 0%, var(--dark-teal) 100%);
  border-radius: 10px;
}

#detailView::-webkit-scrollbar-thumb:hover,
.drawer-body::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, var(--dark-teal) 0%, var(--teal) 100%);
}

/* Chart.js label styling improvements */
.compliance-chart-container canvas {
  filter: brightness(1.1) contrast(1.1);
}

/* Ensure chart text is visible */
.chartjs-render-monitor {
  color: #ffffff !important;
}

.compliance-section h3 {
  -webkit-text-fill-color: #ffffff !important;
  color: #ffffff !important;
  font-size: 18px;
  font-weight: 800;
  margin-bottom: 20px;
  border-bottom: none;
  padding: 14px 22px;
  background: linear-gradient(135deg, rgba(102, 102, 204, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
  border: 2px solid rgba(102, 102, 204, 0.4);
  border-radius: 14px;
  display: inline-flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 8px 24px rgba(102, 102, 204, 0.2);
  letter-spacing: 0.6px;
  text-transform: uppercase;
  transition: all 0.3s ease;
  width: auto;
  white-space: nowrap;
}



</style>
</head>

<body>


<div class="top-nav">
  <!-- LEFT -->
  <div class="logo-container">
    <img src="ascendion-logo.png" alt="Company Logo">
  </div>

  <!-- CENTER -->
  <div class="nav-title">
    Corporate Real Estate Intelligence Hub
  </div>

  <!-- RIGHT -->
  <div class="nav-actions">
    <button class="nav-btn" id="homeBtn" onclick="handleHomeClick()">üè† Home</button>
  </div>
</div>


<div class="top-section" id="topSection">
  
<div class="metrics-grid">
    <div class="metric-box">
      <div class="metric-icon">üåç</div>
      <div class="metric-value" id="totalCountries">--</div>
      <div class="metric-label">Countries</div>
    </div>
    <div class="metric-box">
      <div class="metric-icon">üìç</div>
      <div class="metric-value" id="totalSites">--</div>
      <div class="metric-label">Sites</div>
    </div>
    <div class="metric-box">
      <div class="metric-icon">üè¢</div>
      <div class="metric-value" id="totalRealEstate">--</div>
      <div class="metric-label">Real Estate(Sq Feet)</div>
    </div>
    <div class="metric-box">
      <div class="metric-icon">üë•</div>
      <div class="metric-value" id="totalPeople">--</div>
      <div class="metric-label">Employees</div>
    </div>
    <div class="metric-box">
      <div class="metric-icon">üíµ</div>
      <div class="metric-value" id="totalOpex">--</div>
      <div class="metric-label">OpEx</div>
    </div>
    <div class="metric-box">
      <div class="metric-icon">üíé</div>
      <div class="metric-value" id="assetValue">--</div>
      <div class="metric-label">Asset Value</div>
    </div>
    <div class="metric-box">
      <div class="metric-icon">üìã</div>
      <div class="metric-value" id="compliance">--</div>
      <div class="metric-label">Compliance</div>
    </div>
  </div>
</div>

<div class="page-main">
  <div class="page-main-inner">
    <div class="back-btn" id="backBtn">‚Üê Back</div>
    <div id="map"></div>

    <div id="detailView">
      <h2 id="detailTitle"></h2>

      <div id="coreGrid"></div>
      <div id="efficiencyGrid"></div>
      <div id="financialGrid"></div>

      <!-- ========== COMPLIANCE SECTION (ADDITIVE) ========== -->
      <div class="compliance-section">
        <h3>üìä Compliance Overview</h3>
        <div class="compliance-sites-container" id="complianceSitesContainer"></div>
      </div>
    </div>
  </div>
</div>

<!-- ========== COMPLIANCE DRAWER (ADDITIVE) ========== -->
<div class="drawer-overlay" id="overlay" onclick="closeDrawer()"></div>

<div class="drawer" id="drawer">

  <!-- HEADER (FIXED) -->
  <div class="drawer-header">
    <h2 id="drawerTitle"></h2>
    <button class="close-btn" onclick="closeDrawer()">‚úï Close</button>
  </div>

  <!-- BODY (SCROLLABLE) -->
  <div class="drawer-body">

    <div class="section done">
  <h3>Completed</h3>
  <div id="done"></div>
</div>

<div class="section progress">
  <h3>In Progress</h3>
  <div id="progress"></div>
</div>

<div class="section pending">
  <h3>Pending</h3>
  <div id="notdone"></div>
</div>

  </div>

</div>


<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ================= GOOGLE SHEETS CONFIG ================= */
const SHEET_ID = "14Bz3QibO5MWiOjaF-pvSfDs3enW5Nd6R";
const SHEET_NAME = "UPDATED";

/* ================= MAP INIT ================= */
let map = L.map("map").setView([20, 0], 2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

// After flex layout settles, fix map size
setTimeout(() => {
  map.invalidateSize();
}, 0);

const backBtn = document.getElementById("backBtn");
const detailView = document.getElementById("detailView");
const detailTitle = document.getElementById("detailTitle");

/* ================= STATE ================= */
let currentView = "world";
let currentCountry = null;

/* ================= STATIC MAP DATA ================= */
const countries = {
  "United States": { lat:37, lng:-95, zoom:4, direction: "top", offset: [0, -15] },
  "Mexico": { lat:23, lng:-102, zoom:5, direction: "bottom", offset: [0, 10] },
  "Ireland": { lat:53, lng:-8, zoom:6, direction: "left", offset: [-15, 0] },
  "United Kingdom": { lat:55, lng:-3, zoom:6, direction: "top", offset: [0, -15] },
  "Poland": { lat:52, lng:19, zoom:6, direction: "right", offset: [15, 0] },
  "Romania": { lat:45.9, lng:24.9, zoom:6, direction: "bottom", offset: [0, 10] },
  "India": { lat:21, lng:78, zoom:5, direction: "top", offset: [0, -15] },
  "Malaysia": { lat:4.5, lng:101, zoom:6, direction: "left", offset: [-15, 0] },
  "Philippines": { lat:14, lng:122, zoom:6, direction: "right", offset: [15, 0] },
  "Singapore": { lat:0.5, lng:105, zoom:7, direction: "bottom", offset: [15, 0] },
};
const cities = {
  "India": [
    ["Vadodara",22.31,73.18,"top",[0,-15]],
    ["Bangalore",12.97,77.59,"left",[-15,0]],  // Changed to left
    ["Hyderabad",17.38,78.48,"top",[0,-15]],
    ["Chennai",12.70,80.27,"right",[15,0]],    // Changed to right
    ["Pune",18.52,73.85,"left",[-15,0]]
  ],
  "United States": [
    ["Atlanta",33.75,-84.39,"bottom",[0,18]],
    ["Austin",30.27,-97.74,"bottom",[0,18]],
    ["Basking Ridge",40.71,-74.55,"top",[0,-18]],
    ["Charlotte",35.22,-80.84,"left",[-20,0]],
    ["Chicago",41.88,-87.63,"left",[0,18]],
    ["Dallas",32.78,-96.8,"left",[-18,0]],
    ["Folsom",38.68,-121.18,"top",[0,-18]],
    ["Glen Allen",37.66,-77.5,"right",[20,0]],
    ["Irvine",33.68,-117.83,"right",[18,0]],
    ["Jersey City",40.72,-74.07,"left",[-20,0]],
    ["Minneapolis",44.97,-93.26,"top",[0,-18]],
    ["Pleasanton",37.66,-121.87,"right",[20,0]],
    ["Raleigh",35.78,-78.64,"bottom",[20,0]],
    ["Redmond",47.67,-122.12,"left",[-18,0]],
    ["San Diego",32.71,-117.16,"bottom",[0,18]],
    ["San Francisco",37.77,-122.42,"left",[-20,-5]],
    ["San Jose",37.33,-121.89,"bottom",[0,18]],
    ["Tampa",27.95,-82.46,"right",[18,0]]

  ],
  "Mexico": [
    ["Monterrey",25.68,-100.31]
  ],
  "Philippines": [
    ["Makati",14.6,120.98],
    ["Cebu",10.31,123.89],
  ],
  "Poland": [
    ["Krakow",50.06,19.94],
    ["Warsaw",52.23,21.01]
  ]
};

/* ================= GOOGLE SHEETS LOAD ================= */
/* ================= GOOGLE SHEETS LOAD ================= */
const cityData = {};
const NA = v => (v === null || v === undefined || v === "" ? "NA" : v);


function formatUSD(value) {
  if (value === null || value === undefined || value === "" || value === "NA") {
    return "NA";
  }

  const num = Number(String(value).replace(/,/g, ""));
  if (isNaN(num)) return value;

  return "$" + num.toLocaleString(undefined, {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}


fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${SHEET_NAME}`)
  .then(r => r.text())
  .then(t => {
    const json = JSON.parse(t.substr(47).slice(0, -2));

    json.table.rows.forEach(r => {
      const city = r.c[0]?.v; // Location
      if (!city) return;

      // ‚úÖ MULTI OFFICE SUPPORT
      if (!cityData[city]) {
        cityData[city] = [];
      }

      cityData[city].push({
  location: r.c[0]?.v,          // A
  country: r.c[1]?.v,           // B
  state: r.c[2]?.v,             // C

  officeType: r.c[3]?.v,        // D
  buType: r.c[4]?.v,            // E
  officeName: r.c[5]?.v,        // F

  address: r.c[6]?.v,           // G

  leaseStart: r.c[7]?.f || r.c[7]?.v,   // H
  leaseEnd: r.c[8]?.f || r.c[8]?.v,     // I
  lockIn: r.c[9]?.f || r.c[9]?.v,                // J
  noticePeriod: r.c[10]?.v,             // K

  realEstate: r.c[11]?.v,        // L
  seatingCapacity: r.c[12]?.v,  // M
  employees: r.c[13]?.v,         // N

  monthlyBaseRent: r.c[14]?.f || r.c[14]?.v, // O
  monthlyOpex: r.c[15]?.f || r.c[15]?.v,     // P
  capex: r.c[16]?.f || r.c[16]?.v,           // Q

  costPerSeat: r.c[17]?.f || r.c[17]?.v,     // R
  costPerSqft: r.c[18]?.f || r.c[18]?.v,     // S

  annualSpend: r.c[19]?.f || r.c[19]?.v,     // T
  assetValue: r.c[20]?.f || r.c[20]?.v,      // U

  opexPerSqft: r.c[21]?.f || r.c[21]?.v,     // V
  opexPerSeat: r.c[22]?.f || r.c[22]?.v,     // W
  capexPerSqft: r.c[23]?.f || r.c[23]?.v,    // X
  capexPerSeat: r.c[24]?.f || r.c[24]?.v,    // Y

  securityDeposit: r.c[25]?.f || r.c[25]?.v, // Z
  remarks: r.c[26]?.v                        // AA
});


      });
    

    updateHeaderMetrics(); // ‚úÖ MUST stay here
  });


/* ================= HEADER METRICS ================= */
function cleanNumber(val) {
  if (!val) return 0;
  return Number(String(val).replace(/[$,]/g, ""));
}

function updateHeaderMetrics() {
  const sites = Object.keys(cityData).length;

  let totalRE = 0;
  let totalPeople = 0;
  let totalSpend = 0;
  let totalAssetValue = 0;
  let uniqueCountries = new Set();

  Object.values(cityData).flat().forEach(d => {
  totalRE += cleanNumber(d.realEstate);
  totalPeople += cleanNumber(d.employees);
  totalSpend += cleanNumber(d.annualSpend);
  totalAssetValue += cleanNumber(d.assetValue);
  if (d.country) uniqueCountries.add(d.country);
});

  // Countries
  document.getElementById("totalCountries").innerText = 10;

  
  // Sites
  document.getElementById("totalSites").innerText = sites;

  // Real Estate in Millions (Square Feet)
  document.getElementById("totalRealEstate").innerText =
    totalRE ? (totalRE / 1_000_000).toFixed(2) + "M" : "--";

  // Employees
  document.getElementById("totalPeople").innerText =
    totalPeople ? totalPeople.toLocaleString() : "--";

  // OpEx (Annual Spend) in Millions
  document.getElementById("totalOpex").innerText =
    totalSpend ? "$" + (totalSpend / 1_000_000).toFixed(2) + "M" : "--";

  // Asset Value (using Security Deposit as proxy) in Millions
  document.getElementById("assetValue").innerText =
  totalAssetValue
    ? "$" + (totalAssetValue / 1_000_000).toFixed(2) + "M"
    : "--";


  // Compliance - will be calculated from compliance sheet
  calculateOverallCompliance();
}

function calculateOverallCompliance() {
  if (!complianceDataLoaded) {
    document.getElementById("compliance").innerText = "--";
    return;
  }

  const totalItems = complianceRawData.length;
  if (totalItems === 0) {
    document.getElementById("compliance").innerText = "--";
    return;
  }

  const compliantItems = complianceRawData.filter(r => r.status === "yes").length;
  const compliancePercentage = Math.round((compliantItems / totalItems) * 100);
  
  document.getElementById("compliance").innerText = compliancePercentage + "%";
}
/* ================= NAVIGATION ================= */
let countryMarkers = [];
let cityMarkers = [];

function clearMarkers(list) {
  list.forEach(m => map.removeLayer(m));
  list.length = 0;
}

backBtn.onclick = () => {
  if (currentView === "city") {
    closeDetail();
    currentView = "country";
    showCountry(currentCountry);
  } 
  else if (currentView === "country") {
    showWorld();
  }
};

/* ================= WORLD VIEW ================= */
function showWorld() {
  currentView = "world";
  currentCountry = null;

  closeDetail();
  clearMarkers(countryMarkers);
  clearMarkers(cityMarkers);

  document.getElementById("topSection").style.display = "block";
  backBtn.style.display = "none";

  map.setView([20, 0], 2);

  Object.entries(countries).forEach(([name, c]) => {
    const m = L.circleMarker([c.lat, c.lng], {
      radius: 8,
      color: "#ffffff",
      fillColor: "#0DBCB4",
      fillOpacity: 1,
      weight: 2,
      opacity: 1
    })
      .addTo(map)
      .bindTooltip(name, {
        permanent: true,
        className: "label clickable-label",
        direction: c.direction || "top",
        offset: c.offset || [0, -15],
        interactive: true
      })
      .on("click", () => showCountry(name));

    let tooltipEl = null;

    // Get tooltip element and set up label interactions
    m.on("tooltipopen", e => {
      tooltipEl = e.tooltip.getElement();
      if (tooltipEl) {
        tooltipEl.style.cursor = "pointer";
        tooltipEl.onclick = () => showCountry(name);
        
        // When hovering on label, highlight the dot
        tooltipEl.onmouseenter = () => {
          m.setStyle({
            radius: 8,
            fillColor: "#0DBCB4",
            color: "#0DBCB4",
            weight: 3,
            fillOpacity: 0.8
          });
        };
        
        tooltipEl.onmouseleave = () => {
          m.setStyle({
            radius: 8,
            fillColor: "#0DBCB4",
            color: "#ffffff",
            weight: 2,
            fillOpacity: 1
          });
        };
      }
    });

    // ‚úÖ REMOVED - No hover effect on the dot itself

    countryMarkers.push(m);
  });

  setTimeout(() => map.invalidateSize(), 0);
}
/* ================= COUNTRY VIEW ================= */
/* ================= COUNTRY VIEW ================= */
function showCountry(country) {
  currentView = "country";
  currentCountry = country;

  closeDetail();
  clearMarkers(countryMarkers);
  clearMarkers(cityMarkers);

  document.getElementById("topSection").style.display = "none";
  backBtn.style.display = "block";

  map.setView(
    [countries[country].lat, countries[country].lng],
    countries[country].zoom
  );

  setTimeout(() => {
    (cities[country] || []).forEach(city => {
      // Use positioning data from array, or fallback to defaults
      let direction = city[3] || "right";
      let offset = city[4] || [10, 0];

      const m = L.circleMarker([city[1], city[2]], {
        radius: 8,
        color: "#ffffff",
        fillColor: "#0DBCB4",
        fillOpacity: 1,
        weight: 2,
        opacity: 1
      })
        .addTo(map)
        .bindTooltip(city[0], {
          permanent: true,
          className: "label clickable-label city-label",
          direction,
          offset,
          interactive: true
        })
        .on("click", () => openCity(city[0], country));

      let tooltipEl = null;

      // Get tooltip element and set up label interactions
      m.on("tooltipopen", e => {
        tooltipEl = e.tooltip.getElement();
        if (tooltipEl) {
          tooltipEl.style.cursor = "pointer";
          tooltipEl.onclick = () => openCity(city[0], country);
          
          // When hovering on label, highlight the dot
          tooltipEl.onmouseenter = () => {
            m.setStyle({
              radius: 8,
              fillColor: "#0DBCB4",
              color: "#0DBCB4",
              weight: 3,
              fillOpacity: 0.8
            });
          };
          
          tooltipEl.onmouseleave = () => {
            m.setStyle({
              radius: 8,
              fillColor: "#0DBCB4",
              color: "#ffffff",
              weight: 2,
              fillOpacity: 1
            });
          };
        }
      });

      cityMarkers.push(m);
    });

    map.invalidateSize();
  }, 100);
}
const bangaloreOfficeNames = [
  "Prestige Blue Chip Software Park",
  "Roach Building"
];


function openCity(city, country) {
  currentView = "city";
  currentCountry = country;

  document.getElementById("map").style.display = "none";
  detailView.style.display = "block";
  backBtn.style.display = "block";

  detailTitle.innerText = city;

  const offices = cityData[city] || [];

  let allOfficesHTML = "";

  offices.forEach((d, index) => {

  allOfficesHTML += `
    <div class="office-block"
      style="
        margin-top: ${index === 0 ? '0' : '60px'};
        padding-top: ${index === 0 ? '0' : '40px'};
        border-top: ${index === 0 ? 'none' : '4px solid var(--teal)'};
      ">

      ${d.officeName && d.officeName.trim() !== "" ? `
        <div class="office-title" style="font-size: 26px; margin-bottom: 30px;">
          üè¢ ${d.officeName}
        </div>
      ` : ``}


       <!-- Site Overview -->
<h3 style="margin-top: 0;">Site Overview</h3>
<div class="grid">

  <div class="card">üåç Country<b>${NA(d.country)}</b></div>
  <div class="card">üèô State<b>${NA(d.state)}</b></div>
  <div class="card">üè¢ Office Type<b>${NA(d.officeType)}</b></div>

  <div class="card">üß≠ BU Type<b>${NA(d.buType)}</b></div>
  <div class="card">üë• Employees<b>${NA(d.employees)}</b></div>
  <div class="card">üí∫ Seating Capacity<b>${NA(d.seatingCapacity)}</b></div>
  <div class="card">üìê Area (Sqft)<b>${NA(d.realEstate)}</b></div>

  <div class="card" style="grid-column: span 4;">
    üì´ Address
    <b style="font-size:16px; line-height:1.4;">
      ${NA(d.address)}
    </b>
  </div>

</div>

<!-- Lease Details -->
<h3>Lease & Occupancy Details</h3>
<div class="grid">

  <div class="card">üìÖ Lease Start<b>${NA(d.leaseStart)}</b></div>
  <div class="card">üìÖ Lease End<b>${NA(d.leaseEnd)}</b></div>
  <div class="card">üîí Lock-In Period<b>${NA(d.lockIn)}</b></div>
  <div class="card">‚è± Notice Period<b>${NA(d.noticePeriod)} days</b></div>

</div>

<h3>Financial Summary</h3>
<div class="grid">

  <div class="card">üíµ Monthly Base Rent<b>${formatUSD(d.monthlyBaseRent)}</b></div>
  <div class="card">üßæ Monthly OPEX<b>${formatUSD(d.monthlyOpex)}</b></div>
  <div class="card">üèó Monthly CapEx<b>${formatUSD(d.capex)}</b></div>
  <div class="card">üìä Annual Spend<b>${formatUSD(d.annualSpend)}</b></div>

  <div class="card">üíé Asset Value<b>${formatUSD(d.assetValue)}</b></div>
  <div class="card">üîê Security Deposit<b>${formatUSD(d.securityDeposit)}</b></div>

  <div class="card">üí∫ Cost / Seat<b>${formatUSD(d.costPerSeat)}</b></div>
  <div class="card">üìê Cost / Sqft<b>${formatUSD(d.costPerSqft)}</b></div>

  <div class="card">üìê Opex / Sqft<b>${formatUSD(d.opexPerSqft)}</b></div>
  <div class="card">üí∫ Opex / Seat<b>${formatUSD(d.opexPerSeat)}</b></div>

  <div class="card">üèó Capex / Sqft<b>${formatUSD(d.capexPerSqft)}</b></div>
  <div class="card">ü™ë Capex / Seat<b>${formatUSD(d.capexPerSeat)}</b></div>

  ${d.remarks ? `
  <div class="card" style="grid-column: span 4;">
    üìù Remarks
    <b>${d.remarks}</b>
  </div>
  ` : ''}

</div>


      </div>
    `;
  });

  // Clear the section headers and put all offices in the first grid
  document.getElementById("coreGrid").innerHTML = allOfficesHTML;
  document.getElementById("efficiencyGrid").innerHTML = "";
  document.getElementById("financialGrid").innerHTML = "";

  // Load compliance
  loadComplianceForCity(city);
}

function closeDetail() {
  detailView.style.display = "none";
  document.getElementById("map").style.display = "block";

  // Fix map size when returning from detail view
  setTimeout(() => map.invalidateSize(), 0);
}

/* INIT */
showWorld();

/* ================= COMPLIANCE DATA LOADING (ADDITIVE) ================= */
const COMPLIANCE_SHEET_ID = "1BaIWbKdMjvro5E_IG3ceyNSRA98T-5a-";
const COMPLIANCE_GID = "1802692301";

const complianceSites = [
  { name: "Vadodara", col: 4 },
  { name: "Bangalore PBC", col: 7 },
  { name: "Chennai", col: 10 },
  { name: "Hyderabad", col: 13 },
  { name: "Pune", col: 16 },
  { name: "Bangalore RBD", col: 19 }
];

const complianceRawData = [];
let complianceDataLoaded = false;

fetch(`https://docs.google.com/spreadsheets/d/${COMPLIANCE_SHEET_ID}/gviz/tq?gid=${COMPLIANCE_GID}`)
  .then(r => r.text())
  .then(t => {
    const json = JSON.parse(t.substring(47).slice(0, -2));
    const rows = json.table.rows;

    let currentCategory = "";

    rows.forEach(r => {
      const c = r.c;
      if (!c || !c[1]?.v) return;

      if (c[0]?.v) currentCategory = c[0].v.trim();

      complianceSites.forEach(site => {
        const status = c[site.col]?.v;
        if (!status || status === "NA") return;

        complianceRawData.push({
          city: site.name,
          category: currentCategory,
          area: c[1]?.v,
          doc: c[2]?.v,
          owner: c[3]?.v,
          status: status.trim().toLowerCase()
        });
      });
    });

    complianceDataLoaded = true;
    calculateOverallCompliance(); // Add this line
  });

function loadComplianceForCity(baseCity) {
  const container = document.getElementById("complianceSitesContainer");
  container.innerHTML = "";

  if (!complianceDataLoaded) {
    container.innerHTML = '<p style="color: #718096;">Loading compliance data...</p>';
    setTimeout(() => loadComplianceForCity(baseCity), 500);
    return;
  }

  // Find all sites matching this base city
  const matchingSites = complianceSites.filter(site => {
  if (baseCity === "Bangalore") {
    return site.name.startsWith("Bangalore");
  }
  return site.name === baseCity;
});


  if (matchingSites.length === 0) {
    container.innerHTML = '<p style="color: #718096;">No compliance data available for this location.</p>';
    return;
  }

  matchingSites.forEach(site => {
    const siteData = complianceRawData.filter(r => r.city === site.name);
    
    if (siteData.length === 0) {
      return;
    }

    const grouped = {};
    siteData.forEach(r => {
      if (!grouped[r.category]) {
        grouped[r.category] = { yes: 0, total: 0 };
      }
      grouped[r.category].total++;
      if (r.status === "yes") grouped[r.category].yes++;
    });

    const totalCompliant = siteData.filter(r => r.status === "yes").length;
    const overallScore = Math.round((totalCompliant / siteData.length) * 100);

    const siteCard = document.createElement("div");
    siteCard.className = "compliance-site-card";
    siteCard.innerHTML = `
      <h4>
        ${site.name}
        <span class="compliance-score">${overallScore}%</span>
      </h4>
      <div class="compliance-chart-container">
        <canvas></canvas>
      </div>
    `;
    container.appendChild(siteCard);

    const cats = Object.keys(grouped);
    const values = cats.map(c =>
      Math.round((grouped[c].yes / grouped[c].total) * 100)
    );

    const colors = values.map(v =>
      v >= 90 ? "#48bb78" : v >= 75 ? "#ed8936" : "#f56565"
    );

    new Chart(siteCard.querySelector("canvas"), {
      type: "bar",
      data: {
        labels: cats,
        datasets: [{ data: values, backgroundColor: colors, borderRadius: 6 }]
      },
    options: {
  indexAxis: "y",
  responsive: true,
  maintainAspectRatio: true,
  onClick: (_, el) => {
    if (el.length) openComplianceDrawer(site.name, cats[el[0].index]);
  },
  scales: {
    x: { 
      max: 100,
      border: { display: true, color: 'rgba(255, 255, 255, 0.3)' },
      ticks: { 
        callback: v => v + '%', 
        font: { size: 14, weight: 'bold', family: 'Inter' },
        color: '#ffffff'
      },
      grid: { color: 'rgba(255, 255, 255, 0.15)', lineWidth: 1 }
    },
    y: { 
      border: { display: true, color: 'rgba(255, 255, 255, 0.3)' },
      ticks: { 
        font: { size: 12, weight: '700', family: 'Inter' },
        color: '#ffffff',
        padding: 8,
        crossAlign: 'far',
        mirror: false
      },
      grid: { display: false }
    }
  },
  plugins: { 
    legend: { display: false },
    tooltip: {
      enabled: true,
      backgroundColor: 'rgba(0, 0, 0, 0.95)',
      titleColor: '#00FAC2',
      bodyColor: '#ffffff',
      borderColor: '#00FAC2',
      borderWidth: 2,
      padding: 14,
      titleFont: { size: 15, weight: 'bold' },
      bodyFont: { size: 14 },
      callbacks: { label: ctx => `Compliance: ${ctx.parsed.x}%` }
    }
  }
}

    });
  });
}

function openComplianceDrawer(siteName, category) {
  document.getElementById("drawer").classList.add("open");
  document.getElementById("overlay").classList.add("active");
  document.getElementById("drawerTitle").innerText = `${siteName} ‚Äì ${category}`;

  const done = document.getElementById("done");
  const prog = document.getElementById("progress");
  const notdone = document.getElementById("notdone");

  done.innerHTML = prog.innerHTML = notdone.innerHTML = "";

  const items = complianceRawData.filter(r => r.city === siteName && r.category === category);

  if (items.length === 0) {
    done.innerHTML = '<p style="color: #a0aec0;">No data available</p>';
    return;
  }

  items.forEach(r => {
    const div = document.createElement("div");
    div.className = "item";
    
    const categoryClass = r.category.toLowerCase().replace(/\s+/g, '-');
    const badgeClass = categoryClass.includes('facility') ? 'badge-facility' :
                       categoryClass.includes('fire') ? 'badge-fire' :
                       categoryClass.includes('statutory') ? 'badge-statutory' :
                       categoryClass.includes('vendor') ? 'badge-vendor' :
                       categoryClass.includes('environment') ? 'badge-environment' :
                       'badge-security';
    
    div.innerHTML = `
      <strong>${r.area}</strong>
      <small>${r.owner}</small>
      <span class="category-badge ${badgeClass}">${r.category}</span>
    `;

    if (r.status === "yes") done.appendChild(div);
    else if (r.status.includes('progress')) prog.appendChild(div);
    else notdone.appendChild(div);
  });

  if (!done.children.length) done.innerHTML = '<p style="color: #a0aec0;">No completed items</p>';
  if (!prog.children.length) prog.innerHTML = '<p style="color: #a0aec0;">No items in progress</p>';
  if (!notdone.children.length) notdone.innerHTML = '<p style="color: #a0aec0;">No pending items</p>';
}

function closeDrawer() {
  document.getElementById("drawer").classList.remove("open");
  document.getElementById("overlay").classList.remove("active");
}

/* ================= NAVIGATION BAR HANDLERS ================= */
function handleHomeClick() {
  showWorld();
}



</script>

</body>
</html>
